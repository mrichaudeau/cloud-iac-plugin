# Provider Configuration Template
# Generated by Cloud IaC Plugin
# Variables: {{provider}}, {{region}}, {{environment}}, {{project}}

terraform {
  required_version = "{{terraform_version | default: '>= 1.5.0'}}"

  required_providers {
{{#if provider == "aws"}}
    aws = {
      source  = "hashicorp/aws"
      version = "{{aws_provider_version | default: '~> 5.0'}}"
    }
{{/if}}
{{#if provider == "azure"}}
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "{{azure_provider_version | default: '~> 3.0'}}"
    }
{{/if}}
{{#if provider == "gcp"}}
    google = {
      source  = "hashicorp/google"
      version = "{{gcp_provider_version | default: '~> 5.0'}}"
    }
{{/if}}
    random = {
      source  = "hashicorp/random"
      version = "~> 3.0"
    }
  }
}

{{#if provider == "aws"}}
provider "aws" {
  region = var.region

  default_tags {
    tags = local.common_tags
  }
}

# Provider for global resources (CloudFront, WAF, etc.)
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"

  default_tags {
    tags = local.common_tags
  }
}
{{/if}}

{{#if provider == "azure"}}
provider "azurerm" {
  features {
    key_vault {
      purge_soft_delete_on_destroy    = false
      recover_soft_deleted_key_vaults = true
    }
    resource_group {
      prevent_deletion_if_contains_resources = true
    }
  }

  # Utiliser OIDC pour l'authentification
  use_oidc = true
}
{{/if}}

{{#if provider == "gcp"}}
provider "google" {
  project = var.project_id
  region  = var.region
}

provider "google-beta" {
  project = var.project_id
  region  = var.region
}
{{/if}}

provider "random" {}
