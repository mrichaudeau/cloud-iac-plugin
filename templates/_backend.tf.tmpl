# Backend Configuration Template
# Generated by Cloud IaC Plugin
# Variables: {{project}}, {{environment}}, {{region}}, {{provider}}

{{#if provider == "aws"}}
terraform {
  backend "s3" {
    bucket         = "{{project}}-terraform-state"
    key            = "{{environment}}/{{region}}/terraform.tfstate"
    region         = "{{state_region | default: region}}"
    encrypt        = true
    dynamodb_table = "{{project}}-terraform-locks"

    # Workspaces (optional)
    {{#if use_workspaces}}
    workspace_key_prefix = "workspaces"
    {{/if}}
  }
}
{{/if}}

{{#if provider == "azure"}}
terraform {
  backend "azurerm" {
    resource_group_name  = "{{project}}-tfstate-rg"
    storage_account_name = "{{project | replace: "-", ""}}tfstate"
    container_name       = "tfstate"
    key                  = "{{environment}}/{{region}}/terraform.tfstate"
    use_oidc             = true
  }
}
{{/if}}

{{#if provider == "gcp"}}
terraform {
  backend "gcs" {
    bucket = "{{project}}-terraform-state"
    prefix = "{{environment}}/{{region}}"
  }
}
{{/if}}
